<!DOCTYPE html>
<html lang="th">
<head>
    <title>‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-4 font-sans">
    <div class="max-w-xl mx-auto">
        <div class="sticky top-0 bg-gray-50 pt-2 pb-4 z-10">
            <h1 class="text-xl font-bold mb-3 text-center text-gray-800">‚òï ‡∏Ñ‡∏•‡∏±‡∏á‡∏†‡∏≤‡∏û‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°</h1>
            <input type="text" id="searchInput" onkeyup="filterImages()" 
                   placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π ‡πÄ‡∏ä‡πà‡∏ô ‡∏ä‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß..." 
                   class="w-full p-3 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>

        <div class="mb-6 text-center">
            <button onclick="shareAllImages()" id="shareBtn"
                    class="bg-green-600 text-white w-full py-3 rounded-xl font-bold shadow-lg active:scale-95 transition flex justify-center items-center gap-2">
                üì≤ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ (‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤) ‡∏•‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
            </button>
            <p class="text-xs text-gray-500 mt-2">*‡πÉ‡∏ä‡πâ Safari (iPhone) ‡∏´‡∏£‡∏∑‡∏≠ Chrome (Android) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ</p>
        </div>

        <div id="imageGrid" class="grid grid-cols-2 gap-3">
            {% for img in images %}
            <div class="image-card bg-white p-2 rounded-lg shadow border border-gray-100">
                <img src="/static/images/{{ img }}" class="w-full h-40 object-cover rounded-md mb-2 bg-gray-200" loading="lazy">
                <p class="text-sm font-bold text-gray-700 truncate mb-2 name-label">{{ img.split('.')[0] }}</p>
                <a href="/static/images/{{ img }}" download class="block w-full bg-blue-50 text-blue-600 text-center py-1 rounded text-xs font-semibold border border-blue-200">‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏ô‡∏µ‡πâ</a>
            </div>
            {% endfor %}
        </div>
    </div>

    <script>
        function filterImages() {
            let input = document.getElementById('searchInput').value.toLowerCase();
            let cards = document.getElementsByClassName('image-card');
            for (let i = 0; i < cards.length; i++) {
                let name = cards[i].querySelector('.name-label').innerText.toLowerCase();
                cards[i].style.display = name.includes(input) ? "" : "none";
            }
        }

        async function shareAllImages() {
            const btn = document.getElementById('shareBtn');
            const originalText = btn.innerHTML;
            
            if (!navigator.share || !navigator.canShare) {
                alert("‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå‡∏´‡∏•‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ Safari ‡∏´‡∏£‡∏∑‡∏≠ Chrome ‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠"); return;
            }

            try {
                btn.innerHTML = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û...";
                btn.disabled = true;
                const visibleCards = Array.from(document.querySelectorAll('.image-card')).filter(c => c.style.display !== 'none');
                
                if(visibleCards.length === 0) { alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å"); return; }

                const filesArray = [];
                for (let card of visibleCards) {
                    const imgUrl = card.querySelector('img').src;
                    const fileName = card.querySelector('.name-label').innerText + ".jpg";
                    const response = await fetch(imgUrl);
                    const blob = await response.blob();
                    filesArray.push(new File([blob], fileName, { type: blob.type }));
                }

                if (navigator.canShare({ files: filesArray })) {
                    await navigator.share({ files: filesArray, title: '‡∏£‡∏π‡∏õ‡πÄ‡∏°‡∏ô‡∏π', text: '‡∏£‡∏π‡∏õ‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ñ‡∏£‡∏±‡∏ö' });
                }
            } catch (error) { console.log(error); } 
            finally { btn.innerHTML = originalText; btn.disabled = false; }
        }
    </script>
</body>
</html>